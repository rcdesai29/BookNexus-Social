{"ast":null,"code":"import{Alert,Box,CircularProgress,Container,Typography}from'@mui/material';import React,{useEffect,useState}from'react';import{useParams}from'react-router-dom';import{BookService}from'../app/services/services/BookService';import BookActions from'../components/BookActions';import BookFeedback from'../components/BookFeedback';import{useAuth}from'../hooks/useAuth';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BookDetailPage=()=>{const{isLoggedIn,user}=useAuth();const{id}=useParams();const[book,setBook]=useState(null);const[borrowedBook,setBorrowedBook]=useState(null);const[readBook,setReadBook]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const isOwner=!!(book&&user&&book.owner===user.name);// Check if book is borrowed by current user\nconst isBorrowed=!!borrowedBook;const canApproveReturn=!!(isOwner&&borrowedBook&&!borrowedBook.returned);const isRead=!!readBook;useEffect(()=>{if(!id)return;setLoading(true);const fetchBookData=async()=>{try{// Fetch book details\nconst bookData=await BookService.findBookById(Number(id));setBook(bookData);// Check if user is logged in before fetching status\nif(isLoggedIn){try{var _borrowedBooks$conten,_readBooks$content;// Check if book is borrowed by current user\nconst borrowedBooks=await BookService.findAllBorrowedBooks(0,1000);const borrowed=(_borrowedBooks$conten=borrowedBooks.content)===null||_borrowedBooks$conten===void 0?void 0:_borrowedBooks$conten.find(b=>b.id===Number(id));if(borrowed){setBorrowedBook(borrowed);}// Check if book is in read list\nconst readBooks=await BookService.findAllReadBooks(0,1000);const read=(_readBooks$content=readBooks.content)===null||_readBooks$content===void 0?void 0:_readBooks$content.find(b=>b.id===Number(id));if(read){setReadBook(read);}}catch(statusError){// Ignore status errors - book might not be borrowed/read\nconsole.log('Could not fetch book status:',statusError);}}}catch(err){setError(err);}finally{setLoading(false);}};fetchBookData();},[id]);if(loading)return/*#__PURE__*/_jsx(Container,{sx:{mt:4},children:/*#__PURE__*/_jsx(CircularProgress,{})});if(error)return/*#__PURE__*/_jsx(Container,{sx:{mt:4},children:/*#__PURE__*/_jsx(Alert,{severity:\"error\",children:error.message||String(error)})});if(!book)return/*#__PURE__*/_jsx(Container,{sx:{mt:4},children:/*#__PURE__*/_jsx(Alert,{severity:\"info\",children:\"Book not found.\"})});return/*#__PURE__*/_jsxs(Container,{maxWidth:\"sm\",sx:{mt:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:book.title}),/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle1\",gutterBottom:true,children:[\"by \",book.authorName]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",gutterBottom:true,children:[\"ISBN: \",book.isbn]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",gutterBottom:true,children:book.synopsis}),/*#__PURE__*/_jsx(Box,{sx:{mt:2},children:/*#__PURE__*/_jsx(BookActions,{bookId:book.id,bookTitle:book.title,isBorrowed:isBorrowed,canApproveReturn:canApproveReturn,isOwner:isOwner,isRead:isRead})}),/*#__PURE__*/_jsx(BookFeedback,{bookId:book.id})]});};export default BookDetailPage;","map":{"version":3,"names":["Alert","Box","CircularProgress","Container","Typography","React","useEffect","useState","useParams","BookService","BookActions","BookFeedback","useAuth","jsx","_jsx","jsxs","_jsxs","BookDetailPage","isLoggedIn","user","id","book","setBook","borrowedBook","setBorrowedBook","readBook","setReadBook","loading","setLoading","error","setError","isOwner","owner","name","isBorrowed","canApproveReturn","returned","isRead","fetchBookData","bookData","findBookById","Number","_borrowedBooks$conten","_readBooks$content","borrowedBooks","findAllBorrowedBooks","borrowed","content","find","b","readBooks","findAllReadBooks","read","statusError","console","log","err","sx","mt","children","severity","message","String","maxWidth","variant","gutterBottom","title","authorName","isbn","synopsis","bookId","bookTitle"],"sources":["/Users/cluckbucks/projects/booknexus-social/frontend/src/pages/BookDetailPage.tsx"],"sourcesContent":["import { Alert, Box, CircularProgress, Container, Typography } from '@mui/material';\nimport React, { useEffect, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport type { BookResponse } from '../app/services/models/BookResponse';\nimport type { BorrowedBookResponse } from '../app/services/models/BorrowedBookResponse';\nimport { BookService } from '../app/services/services/BookService';\nimport BookActions from '../components/BookActions';\nimport BookFeedback from '../components/BookFeedback';\nimport { useAuth } from '../hooks/useAuth';\n\nconst BookDetailPage: React.FC = () => {\n  const { isLoggedIn, user } = useAuth();\n  const { id } = useParams<{ id: string }>();\n  const [book, setBook] = useState<BookResponse | null>(null);\n  const [borrowedBook, setBorrowedBook] = useState<BorrowedBookResponse | null>(null);\n  const [readBook, setReadBook] = useState<BorrowedBookResponse | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<any>(null);\n  const isOwner = !!(book && user && book.owner === user.name);\n  \n  // Check if book is borrowed by current user\n  const isBorrowed = !!borrowedBook;\n  const canApproveReturn = !!(isOwner && borrowedBook && !borrowedBook.returned);\n  const isRead = !!readBook;\n\n  useEffect(() => {\n    if (!id) return;\n    setLoading(true);\n    \n    const fetchBookData = async () => {\n      try {\n        // Fetch book details\n        const bookData = await BookService.findBookById(Number(id));\n        setBook(bookData);\n        \n        // Check if user is logged in before fetching status\n        if (isLoggedIn) {\n          try {\n            // Check if book is borrowed by current user\n            const borrowedBooks = await BookService.findAllBorrowedBooks(0, 1000);\n            const borrowed = borrowedBooks.content?.find(b => b.id === Number(id));\n            if (borrowed) {\n              setBorrowedBook(borrowed);\n            }\n            \n            // Check if book is in read list\n            const readBooks = await BookService.findAllReadBooks(0, 1000);\n            const read = readBooks.content?.find(b => b.id === Number(id));\n            if (read) {\n              setReadBook(read);\n            }\n          } catch (statusError) {\n            // Ignore status errors - book might not be borrowed/read\n            console.log('Could not fetch book status:', statusError);\n          }\n        }\n      } catch (err) {\n        setError(err);\n      } finally {\n        setLoading(false);\n      }\n    };\n    \n    fetchBookData();\n  }, [id]);\n\n  if (loading) return <Container sx={{ mt: 4 }}><CircularProgress /></Container>;\n  if (error) return <Container sx={{ mt: 4 }}><Alert severity=\"error\">{error.message || String(error)}</Alert></Container>;\n  if (!book) return <Container sx={{ mt: 4 }}><Alert severity=\"info\">Book not found.</Alert></Container>;\n\n  return (\n    <Container maxWidth=\"sm\" sx={{ mt: 4 }}>\n      <Typography variant=\"h4\" gutterBottom>{book.title}</Typography>\n      <Typography variant=\"subtitle1\" gutterBottom>by {book.authorName}</Typography>\n      <Typography variant=\"body1\" gutterBottom>ISBN: {book.isbn}</Typography>\n      <Typography variant=\"body2\" gutterBottom>{book.synopsis}</Typography>\n      <Box sx={{ mt: 2 }}>\n        <BookActions \n          bookId={book.id!} \n          bookTitle={book.title!}\n          isBorrowed={isBorrowed} \n          canApproveReturn={canApproveReturn}\n          isOwner={isOwner}\n          isRead={isRead}\n        />\n      </Box>\n      <BookFeedback bookId={book.id!} />\n    </Container>\n  );\n};\n\nexport default BookDetailPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}