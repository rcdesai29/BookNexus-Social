{"ast":null,"code":"import{Alert,Box,CircularProgress,Container,Typography}from'@mui/material';import React,{useEffect,useState}from'react';import{useParams}from'react-router-dom';import{BookService}from'../app/services/services/BookService';import BookActions from'../components/BookActions';import BookFeedback from'../components/BookFeedback';import{tokenService}from'../services/tokenService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BookDetailPage=()=>{const{id}=useParams();const[book,setBook]=useState(null);const[borrowedBook,setBorrowedBook]=useState(null);const[readBook,setReadBook]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// Get current user info\nconst currentUser=tokenService.getUser();const isOwner=!!(book&&currentUser&&book.owner===currentUser.name);// Check if book is borrowed by current user\nconst isBorrowed=!!borrowedBook;const canApproveReturn=isOwner&&borrowedBook&&!borrowedBook.returned;const isRead=!!readBook;useEffect(()=>{if(!id)return;setLoading(true);const fetchBookData=async()=>{try{// Fetch book details\nconst bookData=await BookService.findBookById(Number(id));setBook(bookData);// Check if user is logged in before fetching status\nif(tokenService.isLoggedIn()){try{var _borrowedBooks$conten,_readBooks$content;// Check if book is borrowed by current user\nconst borrowedBooks=await BookService.findAllBorrowedBooks(0,1000);const borrowed=(_borrowedBooks$conten=borrowedBooks.content)===null||_borrowedBooks$conten===void 0?void 0:_borrowedBooks$conten.find(b=>b.id===Number(id));if(borrowed){setBorrowedBook(borrowed);}// Check if book is in read list\nconst readBooks=await BookService.findAllReadBooks(0,1000);const read=(_readBooks$content=readBooks.content)===null||_readBooks$content===void 0?void 0:_readBooks$content.find(b=>b.id===Number(id));if(read){setReadBook(read);}}catch(statusError){// Ignore status errors - book might not be borrowed/read\nconsole.log('Could not fetch book status:',statusError);}}}catch(err){setError(err);}finally{setLoading(false);}};fetchBookData();},[id]);if(loading)return/*#__PURE__*/_jsx(Container,{sx:{mt:4},children:/*#__PURE__*/_jsx(CircularProgress,{})});if(error)return/*#__PURE__*/_jsx(Container,{sx:{mt:4},children:/*#__PURE__*/_jsx(Alert,{severity:\"error\",children:error.message||String(error)})});if(!book)return/*#__PURE__*/_jsx(Container,{sx:{mt:4},children:/*#__PURE__*/_jsx(Alert,{severity:\"info\",children:\"Book not found.\"})});return/*#__PURE__*/_jsxs(Container,{maxWidth:\"sm\",sx:{mt:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:book.title}),/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle1\",gutterBottom:true,children:[\"by \",book.authorName]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",gutterBottom:true,children:[\"ISBN: \",book.isbn]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",gutterBottom:true,children:book.synopsis}),/*#__PURE__*/_jsx(Box,{sx:{mt:2},children:/*#__PURE__*/_jsx(BookActions,{bookId:book.id,isBorrowed:isBorrowed,canApproveReturn:canApproveReturn,isOwner:isOwner,isRead:isRead})}),/*#__PURE__*/_jsx(BookFeedback,{bookId:book.id})]});};export default BookDetailPage;","map":{"version":3,"names":["Alert","Box","CircularProgress","Container","Typography","React","useEffect","useState","useParams","BookService","BookActions","BookFeedback","tokenService","jsx","_jsx","jsxs","_jsxs","BookDetailPage","id","book","setBook","borrowedBook","setBorrowedBook","readBook","setReadBook","loading","setLoading","error","setError","currentUser","getUser","isOwner","owner","name","isBorrowed","canApproveReturn","returned","isRead","fetchBookData","bookData","findBookById","Number","isLoggedIn","_borrowedBooks$conten","_readBooks$content","borrowedBooks","findAllBorrowedBooks","borrowed","content","find","b","readBooks","findAllReadBooks","read","statusError","console","log","err","sx","mt","children","severity","message","String","maxWidth","variant","gutterBottom","title","authorName","isbn","synopsis","bookId"],"sources":["/Users/rahildesai/Projects/BookNexus/frontend/src/pages/BookDetailPage.tsx"],"sourcesContent":["import { Alert, Box, CircularProgress, Container, Typography } from '@mui/material';\nimport React, { useEffect, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport type { BookResponse } from '../app/services/models/BookResponse';\nimport type { BorrowedBookResponse } from '../app/services/models/BorrowedBookResponse';\nimport { BookService } from '../app/services/services/BookService';\nimport BookActions from '../components/BookActions';\nimport BookFeedback from '../components/BookFeedback';\nimport { tokenService } from '../services/tokenService';\n\nconst BookDetailPage: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const [book, setBook] = useState<BookResponse | null>(null);\n  const [borrowedBook, setBorrowedBook] = useState<BorrowedBookResponse | null>(null);\n  const [readBook, setReadBook] = useState<BorrowedBookResponse | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<any>(null);\n\n  // Get current user info\n  const currentUser = tokenService.getUser();\n  const isOwner = !!(book && currentUser && book.owner === currentUser.name);\n  \n  // Check if book is borrowed by current user\n  const isBorrowed = !!borrowedBook;\n  const canApproveReturn = isOwner && borrowedBook && !borrowedBook.returned;\n  const isRead = !!readBook;\n\n  useEffect(() => {\n    if (!id) return;\n    setLoading(true);\n    \n    const fetchBookData = async () => {\n      try {\n        // Fetch book details\n        const bookData = await BookService.findBookById(Number(id));\n        setBook(bookData);\n        \n        // Check if user is logged in before fetching status\n        if (tokenService.isLoggedIn()) {\n          try {\n            // Check if book is borrowed by current user\n            const borrowedBooks = await BookService.findAllBorrowedBooks(0, 1000);\n            const borrowed = borrowedBooks.content?.find(b => b.id === Number(id));\n            if (borrowed) {\n              setBorrowedBook(borrowed);\n            }\n            \n            // Check if book is in read list\n            const readBooks = await BookService.findAllReadBooks(0, 1000);\n            const read = readBooks.content?.find(b => b.id === Number(id));\n            if (read) {\n              setReadBook(read);\n            }\n          } catch (statusError) {\n            // Ignore status errors - book might not be borrowed/read\n            console.log('Could not fetch book status:', statusError);\n          }\n        }\n      } catch (err) {\n        setError(err);\n      } finally {\n        setLoading(false);\n      }\n    };\n    \n    fetchBookData();\n  }, [id]);\n\n  if (loading) return <Container sx={{ mt: 4 }}><CircularProgress /></Container>;\n  if (error) return <Container sx={{ mt: 4 }}><Alert severity=\"error\">{error.message || String(error)}</Alert></Container>;\n  if (!book) return <Container sx={{ mt: 4 }}><Alert severity=\"info\">Book not found.</Alert></Container>;\n\n  return (\n    <Container maxWidth=\"sm\" sx={{ mt: 4 }}>\n      <Typography variant=\"h4\" gutterBottom>{book.title}</Typography>\n      <Typography variant=\"subtitle1\" gutterBottom>by {book.authorName}</Typography>\n      <Typography variant=\"body1\" gutterBottom>ISBN: {book.isbn}</Typography>\n      <Typography variant=\"body2\" gutterBottom>{book.synopsis}</Typography>\n      <Box sx={{ mt: 2 }}>\n        <BookActions \n          bookId={book.id!} \n          isBorrowed={isBorrowed} \n          canApproveReturn={canApproveReturn}\n          isOwner={isOwner}\n          isRead={isRead}\n        />\n      </Box>\n      <BookFeedback bookId={book.id!} />\n    </Container>\n  );\n};\n\nexport default BookDetailPage; "],"mappings":"AAAA,OAASA,KAAK,CAAEC,GAAG,CAAEC,gBAAgB,CAAEC,SAAS,CAAEC,UAAU,KAAQ,eAAe,CACnF,MAAO,CAAAC,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,SAAS,KAAQ,kBAAkB,CAG5C,OAASC,WAAW,KAAQ,sCAAsC,CAClE,MAAO,CAAAC,WAAW,KAAM,2BAA2B,CACnD,MAAO,CAAAC,YAAY,KAAM,4BAA4B,CACrD,OAASC,YAAY,KAAQ,0BAA0B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAExD,KAAM,CAAAC,cAAwB,CAAGA,CAAA,GAAM,CACrC,KAAM,CAAEC,EAAG,CAAC,CAAGV,SAAS,CAAiB,CAAC,CAC1C,KAAM,CAACW,IAAI,CAAEC,OAAO,CAAC,CAAGb,QAAQ,CAAsB,IAAI,CAAC,CAC3D,KAAM,CAACc,YAAY,CAAEC,eAAe,CAAC,CAAGf,QAAQ,CAA8B,IAAI,CAAC,CACnF,KAAM,CAACgB,QAAQ,CAAEC,WAAW,CAAC,CAAGjB,QAAQ,CAA8B,IAAI,CAAC,CAC3E,KAAM,CAACkB,OAAO,CAAEC,UAAU,CAAC,CAAGnB,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACoB,KAAK,CAAEC,QAAQ,CAAC,CAAGrB,QAAQ,CAAM,IAAI,CAAC,CAE7C;AACA,KAAM,CAAAsB,WAAW,CAAGjB,YAAY,CAACkB,OAAO,CAAC,CAAC,CAC1C,KAAM,CAAAC,OAAO,CAAG,CAAC,EAAEZ,IAAI,EAAIU,WAAW,EAAIV,IAAI,CAACa,KAAK,GAAKH,WAAW,CAACI,IAAI,CAAC,CAE1E;AACA,KAAM,CAAAC,UAAU,CAAG,CAAC,CAACb,YAAY,CACjC,KAAM,CAAAc,gBAAgB,CAAGJ,OAAO,EAAIV,YAAY,EAAI,CAACA,YAAY,CAACe,QAAQ,CAC1E,KAAM,CAAAC,MAAM,CAAG,CAAC,CAACd,QAAQ,CAEzBjB,SAAS,CAAC,IAAM,CACd,GAAI,CAACY,EAAE,CAAE,OACTQ,UAAU,CAAC,IAAI,CAAC,CAEhB,KAAM,CAAAY,aAAa,CAAG,KAAAA,CAAA,GAAY,CAChC,GAAI,CACF;AACA,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAA9B,WAAW,CAAC+B,YAAY,CAACC,MAAM,CAACvB,EAAE,CAAC,CAAC,CAC3DE,OAAO,CAACmB,QAAQ,CAAC,CAEjB;AACA,GAAI3B,YAAY,CAAC8B,UAAU,CAAC,CAAC,CAAE,CAC7B,GAAI,KAAAC,qBAAA,CAAAC,kBAAA,CACF;AACA,KAAM,CAAAC,aAAa,CAAG,KAAM,CAAApC,WAAW,CAACqC,oBAAoB,CAAC,CAAC,CAAE,IAAI,CAAC,CACrE,KAAM,CAAAC,QAAQ,EAAAJ,qBAAA,CAAGE,aAAa,CAACG,OAAO,UAAAL,qBAAA,iBAArBA,qBAAA,CAAuBM,IAAI,CAACC,CAAC,EAAIA,CAAC,CAAChC,EAAE,GAAKuB,MAAM,CAACvB,EAAE,CAAC,CAAC,CACtE,GAAI6B,QAAQ,CAAE,CACZzB,eAAe,CAACyB,QAAQ,CAAC,CAC3B,CAEA;AACA,KAAM,CAAAI,SAAS,CAAG,KAAM,CAAA1C,WAAW,CAAC2C,gBAAgB,CAAC,CAAC,CAAE,IAAI,CAAC,CAC7D,KAAM,CAAAC,IAAI,EAAAT,kBAAA,CAAGO,SAAS,CAACH,OAAO,UAAAJ,kBAAA,iBAAjBA,kBAAA,CAAmBK,IAAI,CAACC,CAAC,EAAIA,CAAC,CAAChC,EAAE,GAAKuB,MAAM,CAACvB,EAAE,CAAC,CAAC,CAC9D,GAAImC,IAAI,CAAE,CACR7B,WAAW,CAAC6B,IAAI,CAAC,CACnB,CACF,CAAE,MAAOC,WAAW,CAAE,CACpB;AACAC,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAEF,WAAW,CAAC,CAC1D,CACF,CACF,CAAE,MAAOG,GAAG,CAAE,CACZ7B,QAAQ,CAAC6B,GAAG,CAAC,CACf,CAAC,OAAS,CACR/B,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAEDY,aAAa,CAAC,CAAC,CACjB,CAAC,CAAE,CAACpB,EAAE,CAAC,CAAC,CAER,GAAIO,OAAO,CAAE,mBAAOX,IAAA,CAACX,SAAS,EAACuD,EAAE,CAAE,CAAEC,EAAE,CAAE,CAAE,CAAE,CAAAC,QAAA,cAAC9C,IAAA,CAACZ,gBAAgB,GAAE,CAAC,CAAW,CAAC,CAC9E,GAAIyB,KAAK,CAAE,mBAAOb,IAAA,CAACX,SAAS,EAACuD,EAAE,CAAE,CAAEC,EAAE,CAAE,CAAE,CAAE,CAAAC,QAAA,cAAC9C,IAAA,CAACd,KAAK,EAAC6D,QAAQ,CAAC,OAAO,CAAAD,QAAA,CAAEjC,KAAK,CAACmC,OAAO,EAAIC,MAAM,CAACpC,KAAK,CAAC,CAAQ,CAAC,CAAW,CAAC,CACxH,GAAI,CAACR,IAAI,CAAE,mBAAOL,IAAA,CAACX,SAAS,EAACuD,EAAE,CAAE,CAAEC,EAAE,CAAE,CAAE,CAAE,CAAAC,QAAA,cAAC9C,IAAA,CAACd,KAAK,EAAC6D,QAAQ,CAAC,MAAM,CAAAD,QAAA,CAAC,iBAAe,CAAO,CAAC,CAAW,CAAC,CAEtG,mBACE5C,KAAA,CAACb,SAAS,EAAC6D,QAAQ,CAAC,IAAI,CAACN,EAAE,CAAE,CAAEC,EAAE,CAAE,CAAE,CAAE,CAAAC,QAAA,eACrC9C,IAAA,CAACV,UAAU,EAAC6D,OAAO,CAAC,IAAI,CAACC,YAAY,MAAAN,QAAA,CAAEzC,IAAI,CAACgD,KAAK,CAAa,CAAC,cAC/DnD,KAAA,CAACZ,UAAU,EAAC6D,OAAO,CAAC,WAAW,CAACC,YAAY,MAAAN,QAAA,EAAC,KAAG,CAACzC,IAAI,CAACiD,UAAU,EAAa,CAAC,cAC9EpD,KAAA,CAACZ,UAAU,EAAC6D,OAAO,CAAC,OAAO,CAACC,YAAY,MAAAN,QAAA,EAAC,QAAM,CAACzC,IAAI,CAACkD,IAAI,EAAa,CAAC,cACvEvD,IAAA,CAACV,UAAU,EAAC6D,OAAO,CAAC,OAAO,CAACC,YAAY,MAAAN,QAAA,CAAEzC,IAAI,CAACmD,QAAQ,CAAa,CAAC,cACrExD,IAAA,CAACb,GAAG,EAACyD,EAAE,CAAE,CAAEC,EAAE,CAAE,CAAE,CAAE,CAAAC,QAAA,cACjB9C,IAAA,CAACJ,WAAW,EACV6D,MAAM,CAAEpD,IAAI,CAACD,EAAI,CACjBgB,UAAU,CAAEA,UAAW,CACvBC,gBAAgB,CAAEA,gBAAiB,CACnCJ,OAAO,CAAEA,OAAQ,CACjBM,MAAM,CAAEA,MAAO,CAChB,CAAC,CACC,CAAC,cACNvB,IAAA,CAACH,YAAY,EAAC4D,MAAM,CAAEpD,IAAI,CAACD,EAAI,CAAE,CAAC,EACzB,CAAC,CAEhB,CAAC,CAED,cAAe,CAAAD,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}